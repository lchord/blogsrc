language: node_js
sudo: false
node_js:
  - '8'
branches:
  only:
    - master
cache:
  directories:
  - node_modules
  - "~/.npm"
before_install:
  - openssl aes-256-cbc -K $encrypted_e050b012f849_key -iv $encrypted_e050b012f849_iv -in secrets.tar.enc -out secrets.tar -d
  - tar xvf secrets.tar
  - chmod +x after_script.sh
  - mv travis-ci-key ~/.ssh/id_rsa
  - chmod 600 ~/.ssh/id_rsa
  - git config --global user.name 'lchord'
  - git config --global user.email 569187749@qq.com
install:
  - cat pubkey.txt | tee -a ~/.ssh/known_hosts
  - npm install
  - npm install hexo-cli -g
  - npm install hexo-generator-feed --save
  - npm install hexo-generator-sitemap --save
  - npm install gulp --save
  - npm install gulp-htmlclean --save
  - npm install gulp-htmlmin --save
  - npm install gulp-clean-css --save
  - npm install gulp-uglify --save
script:
  - git clone https://github.com/lchord/find.git themes/find
  - hexo clean
  - hexo g
  - gulp
after_script:
  - ./after_script.sh